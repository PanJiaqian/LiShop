import{j as t,k as e,p as s,m as a,n as c,A as l,B as o,u as i,c as d,w as r,d as n,o as u,a as p,z as h,b as f,v as m,f as _,r as y,F as g,t as k,C as b,i as x,e as I,g as C,y as R}from"./index-D--6mQz1.js";import{F as S}from"./FloatingNav.BIlG4RBz.js";import{b as v,u as w,d as q,c as F,e as B}from"./index.XrWgwEH0.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=P({components:{FloatingNav:S},data:()=>({cart:[],showSpecModal:!1,editingItem:{},rooms:[],showRoomModal:!1,targetGroup:null}),computed:{total(){return this.cart.reduce(((t,e)=>t+e.price*(e.quantity||1)),0)},selectedTotal(){return this.cart.reduce(((t,e)=>t+(e.selected?e.price*(e.quantity||1):0)),0)},selectedCount(){return this.cart.filter((t=>t.selected)).length},isAllSelected(){return this.cart.length>0&&this.selectedCount===this.cart.length},selectedThumbs(){return this.cart.filter((t=>t.selected)).slice(0,2).map((t=>t.image||"/static/logo.png"))},officialReduce(){return this.cart.reduce(((t,e)=>t+(e.selected&&e.officialReduce||0)),0)},redReduce(){return this.cart.reduce(((t,e)=>t+(e.selected&&e.redReduce||0)),0)},extraReduce(){return this.cart.reduce(((t,e)=>t+(e.selected&&e.reduce||0)),0)},totalReduce(){return this.officialReduce+this.redReduce+this.extraReduce},payable(){return Math.max(0,this.selectedTotal-this.totalReduce)},needForCoupon(){return Math.max(0,800-this.payable).toFixed(2)},groups:function(){try{const t={};return(this.cart||[]).forEach((e=>{const s=e.roomName||"ÈªòËÆ§ÊàøÈó¥";t[s]||(t[s]=[]),t[s].push(e)})),Object.keys(t).map((e=>({name:e,items:t[e]})))}catch(t){return console.error("groups computed error",t),[]}}},onShow(){this.load();try{t({animation:!1})}catch(e){}},methods:{load(){v().then((t=>{if("string"==typeof t&&(t.includes("Á©∫")||"ÂΩìÂâçË¥≠Áâ©ËΩ¶‰∏∫Á©∫"===t))return void(this.cart=[]);const e=t&&t.data&&"object"==typeof t.data?t.data:t,s=Array.isArray(null==e?void 0:e.groups)?e.groups:[],a=[];for(const c of s){const t=c&&c.room_name?c.room_name:"",e=Array.isArray(c&&c.items)?c.items:[];for(const s of e)a.push({id:s&&s.id?s.id:"",title:s&&s.product_id?s.product_id:"",productId:s&&s.product_id?s.product_id:"",price:Number(void 0!==(s&&s.price)?s.price:0)||0,quantity:Number(void 0!==(s&&s.quantity)?s.quantity:1)||1,image:"/static/logo.png",roomName:t||"ÈªòËÆ§ÊàøÈó¥",roomId:c.room_id||"",length:s.length||1,color:s.color||"ÊöñÁôΩ",note:s.note||"",attr:(s&&s.length?"ÈïøÂ∫¶ "+s.length:"")+(s&&s.note?" ÔΩú "+s.note:""),selected:!1})}this.cart=a})).catch((t=>{console.error("Get cart failed",t);try{this.cart=e("cart")||[]}catch(s){this.cart=[]}this.cart=(this.cart||[]).map((t=>({...t,quantity:t.quantity||1,selected:!!t.selected})))}))},sync(){s("cart",this.cart)},findIndexById(t){return this.cart.findIndex((e=>e.id===t))},incById(t){const e=this.findIndexById(t);if(e>=0){const t=this.cart[e];this.updateItemQuantity(t,t.quantity+1)}},decById(t){const e=this.findIndexById(t);if(e>=0){const t=this.cart[e];t.quantity>1&&this.updateItemQuantity(t,t.quantity-1)}},updateItemQuantity(t,e){w({id:t.id,room_id:t.roomId,product_id:t.productId,length:t.length,quantity:e,color:t.color,note:t.note}).then((s=>{s&&s.success?(t.quantity=e,this.sync()):a({title:"Êõ¥Êñ∞Â§±Ë¥•",icon:"none"})})).catch((t=>{console.error(t),a({title:"Êõ¥Êñ∞Âá∫Èîô",icon:"none"})}))},removeById(t){q({id:t}).then((()=>{const e=this.findIndexById(t);e>=0&&(this.cart.splice(e,1),this.sync()),a({title:"Â∑≤Âà†Èô§",icon:"success"})})).catch((()=>{const e=this.findIndexById(t);e>=0&&(this.cart.splice(e,1),this.sync()),a({title:"Êú¨Âú∞Âà†Èô§",icon:"none"})}))},removeSelected(){this.cart=this.cart.filter((t=>!t.selected)),this.sync()},clearRemote(){F().then((t=>{t&&t.success?(this.cart=[],this.sync(),a({title:"Â∑≤Ê∏ÖÁ©∫",icon:"success"})):a({title:t&&t.message?t.message:"Ê∏ÖÁ©∫Â§±Ë¥•",icon:"none"})})).catch((()=>{a({title:"Ê∏ÖÁ©∫Â§±Ë¥•",icon:"none"})}))},toggleById(t){const e=this.findIndexById(t);e>=0&&(this.cart[e].selected=!this.cart[e].selected,this.sync())},toggleAll(){const t=!(this.selectedCount===this.cart.length&&this.cart.length>0);this.cart.forEach((e=>e.selected=t)),this.sync()},clear(){this.cart=[],this.sync()},checkout(){if(0===this.selectedCount)return void a({title:"ËØ∑ÈÄâÊã©ÂïÜÂìÅ",icon:"none"});const t=this.cart.filter((t=>t.selected)),l={};t.forEach((t=>{const e=t.roomName||"ÈªòËÆ§ÊàøÈó¥";l[e]||(l[e]=[]),l[e].push({id:t.id,title:t.title,price:t.price,quantity:t.quantity,specTemp:t.specTemp||"",specLength:t.specLength||"",roomName:e})}));const o=Object.keys(l).map((t=>{const e=l[t],s=e.reduce(((t,e)=>t+e.price*e.quantity),0);return{name:t,items:e,roomTotal:s}})),i=new Date,d=Date.now(),r=`JD${i.getFullYear()}${String(i.getMonth()+1).padStart(2,"0")}${String(i.getDate()).padStart(2,"0")}${String(d).slice(-6)}`,n=`WB${Math.floor(1e10*Math.random()).toString().padStart(10,"0")}`,u=i.getTime(),p=[{time:new Date(u).toISOString(),status:"Â∑≤‰∏ãÂçï",desc:"ËÆ¢ÂçïÂ∑≤Êèê‰∫§ÔºåÁ≠âÂæÖÂïÜÂÆ∂Â§ÑÁêÜ",place:"Á≥ªÁªü"},{time:new Date(u+3e5).toISOString(),status:"Êã£Ë¥ß‰∏≠",desc:"ÂïÜÂÆ∂Ê≠£Âú®‰∏∫ÊÇ®Êã£Ë¥ß",place:"‰ªìÂ∫ì"},{time:new Date(u+18e5).toISOString(),status:"Â∑≤ÊèΩÊî∂",desc:"Âø´ÈÄíÂ∑≤ÊèΩÊî∂ÂåÖË£π",place:"ÊèΩÊî∂ÁÇπ"}],h={id:d,orderNo:r,waybillNo:n,createdAt:i.toISOString(),rooms:o,total:o.reduce(((t,e)=>t+e.roomTotal),0),tracking:p};try{const t=e("orders")||[];s("orders",[h,...t]),this.cart=this.cart.filter((t=>!t.selected)),this.sync(),this.exportExcel(h),a({title:"Â∑≤ÁîüÊàêËÆ¢Âçï",icon:"success"}),c({url:"/pages/order/index?id="+h.id})}catch(f){console.error(f)}},exportExcel(t){try{let e='<table border="1" cellspacing="0" cellpadding="4"><tr>'+["ÊàøÈó¥","ÂïÜÂìÅ","ÂûãÂè∑","Ëâ≤Ê∏©","ÈïøÂ∫¶","Âçï‰ª∑","Êï∞Èáè","ÈáëÈ¢ù"].map((t=>`<th>${t}</th>`)).join("")+"</tr>";t.rooms.forEach((t=>{t.items.forEach((s=>{const a=[t.name,s.title,s.id,s.specTemp||"",s.specLength||"",s.price.toFixed(2),s.quantity,(s.price*s.quantity).toFixed(2)];e+="<tr>"+a.map((t=>`<td>${t}</td>`)).join("")+"</tr>"}))})),e+="</table>";const s=new Blob([`\ufeff${e}`],{type:"application/vnd.ms-excel"}),a=URL.createObjectURL(s),c=document.createElement("a");c.href=a,c.download=`ËÆ¢Âçï_${t.id}.xls`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(a)}catch(e){}},openSpecPopup(t){this.editingItem=t,this.showSpecModal=!0},closeSpecPopup(){this.showSpecModal=!1,this.editingItem={}},loadRooms(){B().then((t=>{var e;const s=Array.isArray(null==(e=null==t?void 0:t.data)?void 0:e.items)?t.data.items:[];this.rooms=s.map((t=>({id:t.room_id,name:t.name})))})).catch((t=>{console.error("Get rooms failed",t),this.rooms=(e("rooms")||[]).map((t=>({id:t,name:t})))}))},openRoomPopup(t){this.targetGroup=t,this.showRoomModal=!0,0===this.rooms.length&&this.loadRooms()},closeRoomPopup(){this.showRoomModal=!1,this.targetGroup=null},selectRoom(t){if(!this.targetGroup||!this.targetGroup.items)return;const e=this.targetGroup.items;l({title:"ÁßªÂä®‰∏≠"});const s=e.map((e=>w({id:e.id,room_id:t.id,product_id:e.productId,length:e.length,quantity:e.quantity,color:e.color,note:e.note})));Promise.all(s).then((()=>{o(),a({title:"Â∑≤ÁßªÂä®Âà∞ "+t.name,icon:"success"}),this.closeRoomPopup(),this.load()})).catch((()=>{o(),a({title:"ÁßªÂä®ÈÉ®ÂàÜÂ§±Ë¥•",icon:"none"}),this.closeRoomPopup(),this.load()}))}}},[["render",function(t,e,s,a,c,l){const o=n,S=x,v=I,w=C,q=i("FloatingNav"),F=R;return u(),d(o,{class:"page"},{default:r((()=>[p(o,{class:"cart-grid"},{default:r((()=>[p(o,{class:"cart-main"},{default:r((()=>[c.cart.length?(u(),d(o,{key:0,class:"toolbar"},{default:r((()=>[p(o,{class:"tool-left"},{default:r((()=>[p(o,{class:"chk all",onClick:l.toggleAll},{default:r((()=>[p(o,{class:h(["chk-ico",{on:l.isAllSelected}])},null,8,["class"]),p(S,{class:"chk-txt"},{default:r((()=>[f("ÂÖ®ÈÄâ")])),_:1})])),_:1},8,["onClick"])])),_:1}),p(o,{class:"tool-right"},{default:r((()=>[p(v,{size:"mini",class:"btn-clear",onClick:l.clearRemote},{default:r((()=>[f("Ê∏ÖÁ©∫")])),_:1},8,["onClick"])])),_:1})])),_:1})):m("",!0),c.cart.length?(u(),d(o,{key:1,class:"list h5"},{default:r((()=>[(u(!0),_(g,null,y(l.groups,((t,e)=>(u(),d(o,{class:"group",key:t.name},{default:r((()=>[p(o,{class:"group-header"},{default:r((()=>[p(S,{class:"room"},{default:r((()=>[f(k(t.name),1)])),_:2},1024)])),_:2},1024),(u(!0),_(g,null,y(t.items,(t=>(u(),d(o,{class:"item",key:t.id},{default:r((()=>[p(o,{class:"chk",onClick:e=>l.toggleById(t.id)},{default:r((()=>[p(o,{class:h(["chk-ico",{on:t.selected}])},null,8,["class"])])),_:2},1032,["onClick"]),p(w,{class:"cover",src:t.image||"/static/logo.png",mode:"aspectFill"},null,8,["src"]),p(o,{class:"meta"},{default:r((()=>[p(o,{class:"row-title"},{default:r((()=>[p(S,{class:"title"},{default:r((()=>[f(k(t.title),1)])),_:2},1024)])),_:2},1024),p(o,{class:"row-attr"},{default:r((()=>[p(S,{class:"attr-txt"},{default:r((()=>[f(k(t.attr),1)])),_:2},1024)])),_:2},1024),p(o,{class:"row-main"},{default:r((()=>[p(o,{class:"price-box"},{default:r((()=>[p(S,{class:"price"},{default:r((()=>[f("¬•"+k(t.price.toFixed(2)),1)])),_:2},1024)])),_:2},1024),p(o,{class:"qty-box"},{default:r((()=>[p(o,{class:"qty-btn",onClick:b((e=>l.decById(t.id)),["stop"])},{default:r((()=>[f("-")])),_:2},1032,["onClick"]),p(S,{class:"qty-num"},{default:r((()=>[f(k(t.quantity),1)])),_:2},1024),p(o,{class:"qty-btn",onClick:b((e=>l.incById(t.id)),["stop"])},{default:r((()=>[f("+")])),_:2},1032,["onClick"])])),_:2},1024),p(o,{class:"actions-col"},{default:r((()=>[p(S,{class:"act-txt del",onClick:b((e=>l.removeById(t.id)),["stop"])},{default:r((()=>[f("Âà†Èô§")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})):(u(),d(o,{key:2,class:"empty"},{default:r((()=>[f("Ë¥≠Áâ©ËΩ¶Á©∫Á©∫Â¶Ç‰πü~")])),_:1}))])),_:1}),p(o,{class:"cart-aside"},{default:r((()=>[p(o,{class:"summary-card"},{default:r((()=>[p(o,{class:"sum-title"},{default:r((()=>[f("ÁªìÁÆóÊòéÁªÜ")])),_:1}),p(o,{class:"sum-hint"},{default:r((()=>[f("ÂÆûÈôÖ‰ºòÊÉ†ÈáëÈ¢ù‰ª•‰∏ãÂçïÈ°µ‰∏∫ÂáÜ")])),_:1}),l.selectedCount>0?(u(),d(o,{key:0,class:"sum-body"},{default:r((()=>[p(o,{class:"thumbs"},{default:r((()=>[(u(!0),_(g,null,y(l.selectedThumbs,((t,e)=>(u(),d(w,{key:e,src:t,class:"thumb",mode:"aspectFill"},null,8,["src"])))),128))])),_:1}),p(o,{class:"rows"},{default:r((()=>[p(o,{class:"row"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("ÂïÜÂìÅÊÄª‰ª∑")])),_:1}),p(S,{class:"value"},{default:r((()=>[f("¬•"+k(l.selectedTotal.toFixed(2)),1)])),_:1})])),_:1}),p(o,{class:"row"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("ÂÖ±Âáè")])),_:1}),p(S,{class:"value reduce"},{default:r((()=>[f("Âáè ¬•"+k(l.totalReduce.toFixed(2)),1)])),_:1})])),_:1}),p(o,{class:"row small"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("ÂÆòÊñπÁ´ãÂáè")])),_:1}),p(S,{class:"value reduce"},{default:r((()=>[f("Âáè ¬•"+k(l.officialReduce.toFixed(2)),1)])),_:1})])),_:1}),p(o,{class:"row small"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("Á∫¢ÂåÖ")])),_:1}),p(S,{class:"value reduce"},{default:r((()=>[f("Âáè ¬•"+k(l.redReduce.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),p(o,{class:"coupon-bar"},{default:r((()=>[p(S,{class:"coupon-txt"},{default:r((()=>[f("Ê∂àË¥πÂà∏ÔΩúÂÜçÂÆû‰ªò"+k(l.needForCoupon)+"‰∫´Êª°800Âáè80",1)])),_:1}),p(S,{class:"coupon-action"},{default:r((()=>[f("ÂáëÂçï‚Ä∫")])),_:1})])),_:1}),p(o,{class:"row total"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("ÂêàËÆ°Ôºö")])),_:1}),p(o,{class:"total-box"},{default:r((()=>[p(S,{class:"pay"},{default:r((()=>[f("¬•"+k(l.payable.toFixed(2)),1)])),_:1}),p(S,{class:"total-reduce"},{default:r((()=>[f("ÂÖ±Âáè ¬• "+k(l.totalReduce.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),p(v,{class:"checkout",onClick:l.checkout},{default:r((()=>[f("ÁªìÁÆó("+k(l.selectedCount)+")",1)])),_:1},8,["onClick"])])),_:1})):(u(),d(o,{key:1,class:"sum-empty"},{default:r((()=>[p(o,{class:"empty-ico"},{default:r((()=>[f("üõí")])),_:1}),p(o,{class:"empty-tip"},{default:r((()=>[f("ÈÄâÊã©ÂïÜÂìÅÊü•ÁúãÂÆûÈôÖÊîØ‰ªò‰ª∑Ê†º")])),_:1}),p(o,{class:"row total"},{default:r((()=>[p(S,{class:"label"},{default:r((()=>[f("ÂêàËÆ°Ôºö")])),_:1}),p(o,{class:"total-box"},{default:r((()=>[p(S,{class:"pay"},{default:r((()=>[f("¬•0")])),_:1})])),_:1})])),_:1}),p(v,{class:"checkout disabled"},{default:r((()=>[f("ÁªìÁÆó")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),p(q),c.showSpecModal?(u(),d(o,{key:0,class:"spec-modal-mask",onClick:l.closeSpecPopup},{default:r((()=>[p(o,{class:"spec-modal",onClick:e[0]||(e[0]=b((()=>{}),["stop"]))},{default:r((()=>[p(o,{class:"spec-header"},{default:r((()=>[p(w,{class:"spec-img",src:c.editingItem.image||"/static/logo.png",mode:"aspectFill"},null,8,["src"]),p(o,{class:"spec-info"},{default:r((()=>[p(S,{class:"spec-price"},{default:r((()=>[f("¬•"+k(c.editingItem.price),1)])),_:1}),p(S,{class:"spec-selected"},{default:r((()=>[f("Â∑≤ÈÄâ: "+k(c.editingItem.attr),1)])),_:1})])),_:1}),p(o,{class:"spec-close",onClick:l.closeSpecPopup},{default:r((()=>[f("‚úï")])),_:1},8,["onClick"])])),_:1}),p(F,{"scroll-y":"",class:"spec-body"},{default:r((()=>[p(o,{class:"spec-group"},{default:r((()=>[p(S,{class:"spec-title"},{default:r((()=>[f("Á≥ªÂàó")])),_:1}),p(o,{class:"spec-list"},{default:r((()=>[p(S,{class:"spec-opt active"},{default:r((()=>[f("ËãπÊûú17Á≥ªÂàóÈí¢ÂåñËÜú")])),_:1}),p(S,{class:"spec-opt"},{default:r((()=>[f("ËãπÊûú17Á≥ªÂàóÊâãÊú∫Â£≥")])),_:1}),p(S,{class:"spec-opt"},{default:r((()=>[f("ËãπÊûú16-15Á≥ªÂàóÊâãÊú∫Ë¥¥ËÜú")])),_:1})])),_:1})])),_:1}),p(o,{class:"spec-group"},{default:r((()=>[p(S,{class:"spec-title"},{default:r((()=>[f("È¢úËâ≤")])),_:1}),p(o,{class:"spec-list"},{default:r((()=>[p(S,{class:"spec-opt"},{default:r((()=>[f("‰∏ì‰∏öÁâà-AsahiÊäëËèåÂü∫Êùê")])),_:1}),p(S,{class:"spec-opt active"},{default:r((()=>[f("‰∏ì‰∏öÁâà2ÁâáË£Ö-AsahiÂü∫Êùê")])),_:1}),p(S,{class:"spec-opt"},{default:r((()=>[f("ËøáÊª§ËìùÂÖâÁâà-Êä§ÁúºËÆ§ËØÅ")])),_:1})])),_:1})])),_:1}),p(o,{class:"spec-group"},{default:r((()=>[p(S,{class:"spec-title"},{default:r((()=>[f("ÁâàÊú¨")])),_:1}),p(o,{class:"spec-list"},{default:r((()=>[p(S,{class:"spec-opt active"},{default:r((()=>[f("iPhone16ProMax")])),_:1}),p(S,{class:"spec-opt"},{default:r((()=>[f("16Plus/15Plus/14ProMax")])),_:1})])),_:1})])),_:1})])),_:1}),p(o,{class:"spec-footer"},{default:r((()=>[p(v,{class:"spec-btn cancel",onClick:l.closeSpecPopup},{default:r((()=>[f("ÂèñÊ∂à")])),_:1},8,["onClick"]),p(v,{class:"spec-btn confirm",onClick:l.closeSpecPopup},{default:r((()=>[f("Á°ÆËÆ§")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onClick"])):m("",!0)])),_:1})}],["__scopeId","data-v-75f577f0"]]);export{A as default};
