import{m as e,c as t,w as s,v as l,d as a,o as i,a as o,f as c,r as d,F as n,b as r,t as p,C as m,g as u,i as h,I as f,e as _,z as g}from"./index-D--6mQz1.js";import{k as y,l as v,m as S,e as k,n as C}from"./index.XrWgwEH0.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=I({data:()=>({product:null,current:0,qty:1,specTemp:"",specLength:"",roomName:"",roomId:"",roomsRaw:[],mpSheet:!1,mpRoomSheet:!1,mpTemp:"",mpLength:"",mpRoom:"",mpQty:1,specs:[],specsLoading:!1,roomSheet:!1,roomsList:[],roomInput:"",selectedSpecIndex:-1,isSpecsCollapsed:!0}),onLoad(e){const t=decodeURIComponent((null==e?void 0:e.id)||"");t?y({available_product_id:t}).then((e=>{const s=(null==e?void 0:e.data)||{},l=e=>"string"==typeof e?e.replace(/`/g,"").trim():"",a=e=>Array.isArray(e)?e.map(l).filter(Boolean):[],i=a(s.main_image),o=a(s.images),c=Number(s.price??0)||0,d={id:s.available_product_id||t,title:s.name||"商品 "+t,price:c,sales:0,shipping_origin:l(s.shipping_origin)||"",image:i[0]||"/static/logo.png",images:o.length?o:i.length?i:["/static/logo.png"]};this.product=d,this.fetchSpecs(d.id)})).catch((()=>{this.product={id:t,title:"商品 "+t,price:0,sales:0,shipping_origin:"",image:"/static/logo.png",images:["/static/logo.png"]},this.fetchSpecs(t)})):this.product={id:"",title:"商品",price:0,sales:0,image:"/static/logo.png",images:["/static/logo.png"]}},computed:{images(){var e;const t=this.product&&this.product.images||[];return t.length?t:[(null==(e=this.product)?void 0:e.image)||"/static/logo.png"]},currentImage(){const e=this.images;return e[this.current]||e[0]}},methods:{fetchSpecs(e){if(!e)return;this.specsLoading=!0;v({available_product_id:e}).then((e=>{const t=e&&e.data&&Array.isArray(e.data.children)?e.data.children:Array.isArray(null==e?void 0:e.children)?e.children:[];this.specs=(t||[]).map((e=>{return{product_id:e.product_id||"",name:e.name||"",unit:e.unit||"",price:Number(e.price??0)||0,original_price:Number(e.original_price??0)||0,image_url:(t=e.image_url,("string"==typeof t?t.replace(/`/g,"").trim():"")||"")};var t}))})).catch((()=>{this.specs=[]})).finally((()=>{this.specsLoading=!1,this.selectedSpecIndex=-1}))},selectSpec(e){this.selectedSpecIndex!==e&&(this.selectedSpecIndex=e)},addToCart(){var t;const s=this.selectedSpecIndex>=0&&this.specs[this.selectedSpecIndex]?this.specs[this.selectedSpecIndex]:null,l=s?s.product_id:(null==(t=this.product)?void 0:t.id)||"";S({product_id:l,quantity:1}).then((t=>{t&&t.success?e({title:"已加入购物车",icon:"success"}):e({title:(null==t?void 0:t.message)||"加入失败",icon:"none"})})).catch((()=>{e({title:"加入购物车失败",icon:"none"})}))},incQty(){this.qty+=1},decQty(){this.qty=Math.max(1,this.qty-1)},addToCartWithQty(){var t;const s=(this.roomName||"").trim();if(!s)return void e({title:"请先填写房间名",icon:"none"});const l=(this.specLength||"").replace(/[^0-9.]/g,""),a=l?Number(l):void 0,i=this.selectedSpecIndex>=0&&this.specs[this.selectedSpecIndex]?this.specs[this.selectedSpecIndex]:null,o=i?i.product_id:(null==(t=this.product)?void 0:t.id)||"";S({room_id:this.roomId,product_id:o,length:a,quantity:this.qty,color:this.specTemp||"",note:""}).then((t=>{t&&t.success?e({title:`已加入房间：${s}`,icon:"success"}):e({title:(null==t?void 0:t.message)||"加入失败",icon:"none"})})).catch((()=>{e({title:"加入购物车失败",icon:"none"})}))},buyNow(){e({title:"暂未接入下单",icon:"none"})},openSpecSheet(){var e;this.mpSheet=!0;const t=(null==(e=this.product)?void 0:e.id)||"";this.fetchSpecs(t)},closeSpecSheet(){this.mpSheet=!1},openRoomSheet(){this.roomInput=this.roomName||"",this.roomSheet=!0,k().then((e=>{var t,s,l;const a=Array.isArray(null==(t=null==e?void 0:e.data)?void 0:t.items)?e.data.items:Array.isArray(null==e?void 0:e.items)?e.items:Array.isArray(null==(s=null==e?void 0:e.data)?void 0:s.children)?e.data.children:Array.isArray(null==(l=null==e?void 0:e.data)?void 0:l.list)?e.data.list:Array.isArray(null==e?void 0:e.data)?e.data:[];this.roomsRaw=(a||[]).map((e=>"string"==typeof e?{id:"",name:e}:{id:(null==e?void 0:e.id)||(null==e?void 0:e.room_id)||"",name:(null==e?void 0:e.name)||(null==e?void 0:e.room_name)||""})),this.roomsList=this.roomsRaw.map((e=>e.name)).filter((e=>!!e))})).catch((()=>{this.roomsList=[]}))},closeRoomSheet(){this.roomSheet=!1},confirmRoomSelect(){const t=(this.roomInput||"").trim();if(!t)return void e({title:"请填写房间名",icon:"none"});if(!this.roomsList.includes(t))C({name:t}).then((()=>{this.roomName=t,this.roomSheet=!1,e({title:"房间已创建",icon:"success"})})).catch((()=>{e({title:"创建房间失败",icon:"none"})}));else{this.roomName=t;const e=(this.roomsRaw||[]).find((e=>e.name===t));this.roomId=e?e.id:"",this.roomSheet=!1}},confirmSpecToCart(){var t;if(!(this.mpRoom&&this.mpTemp&&this.mpLength&&this.mpQty))return void e({title:"请填写房间名、色温、长度、数量",icon:"none"});const s=(this.mpRoom||"").trim(),l=(this.roomsRaw||[]).find((e=>e.name===s)),a=l?l.id:"",i=(this.mpLength||"").replace(/[^0-9.]/g,""),o=i?Number(i):void 0,c=this.selectedSpecIndex>=0&&this.specs[this.selectedSpecIndex]?this.specs[this.selectedSpecIndex]:null,d=c?c.product_id:(null==(t=this.product)?void 0:t.id)||"";S({room_id:a,room_name:s,product_id:d,length:o,quantity:this.mpQty,color:this.mpTemp||"",note:""}).then((t=>{t&&t.success?(this.mpSheet=!1,e({title:`已加入房间：${s}`,icon:"success"})):e({title:(null==t?void 0:t.message)||"加入失败",icon:"none"})})).catch((()=>{e({title:"加入购物车失败",icon:"none"})}))},openMpRoomSheet(){this.roomInput=this.mpRoom||"",this.mpRoomSheet=!0,k().then((e=>{var t,s,l;const a=Array.isArray(null==(t=null==e?void 0:e.data)?void 0:t.items)?e.data.items:Array.isArray(null==e?void 0:e.items)?e.items:Array.isArray(null==(s=null==e?void 0:e.data)?void 0:s.children)?e.data.children:Array.isArray(null==(l=null==e?void 0:e.data)?void 0:l.list)?e.data.list:Array.isArray(null==e?void 0:e.data)?e.data:[];this.roomsRaw=(a||[]).map((e=>"string"==typeof e?{id:"",name:e}:{id:(null==e?void 0:e.id)||(null==e?void 0:e.room_id)||"",name:(null==e?void 0:e.name)||(null==e?void 0:e.room_name)||""})),this.roomsList=this.roomsRaw.map((e=>e.name)).filter((e=>!!e))})).catch((()=>{this.roomsList=[]}))},closeMpRoomSheet(){this.mpRoomSheet=!1},confirmMpRoomSelect(){const t=(this.roomInput||"").trim();if(!t)return void e({title:"请填写房间名",icon:"none"});!this.roomsList.includes(t)?C({name:t}).then((()=>{this.mpRoom=t,this.mpRoomSheet=!1,e({title:"房间已创建",icon:"success"})})).catch((()=>{e({title:"创建房间失败",icon:"none"})})):(this.mpRoom=t,this.mpRoomSheet=!1)}}},[["render",function(e,y,v,S,k,C){const I=u,b=a,R=h,A=f,x=_;return k.product?(i(),t(b,{key:0,class:"page"},{default:s((()=>[o(b,{class:"pd-grid"},{default:s((()=>[o(b,{class:"pd-left"},{default:s((()=>[o(b,{class:"pd-gallery"},{default:s((()=>[o(I,{class:"pd-main",src:C.currentImage,mode:"aspectFill"},null,8,["src"]),o(b,{class:"pd-thumbs"},{default:s((()=>[(i(!0),c(n,null,d(C.images,((e,s)=>(i(),t(I,{key:s,class:g(["pd-thumb",{active:s===k.current}]),src:e,mode:"aspectFill",onClick:e=>k.current=s},null,8,["src","class","onClick"])))),128))])),_:1})])),_:1}),o(b,{class:"pd-card pd-params"},{default:s((()=>[o(R,{class:"pd-section-title"},{default:s((()=>[r("参数信息")])),_:1}),o(b,{class:"pd-param-grid"},{default:s((()=>[o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("型号")])),_:1}),o(R,{class:"val"},{default:s((()=>[r(p(k.product.id||"默认款"),1)])),_:1})])),_:1}),o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("名称")])),_:1}),o(R,{class:"val"},{default:s((()=>[r(p(k.product.title),1)])),_:1})])),_:1}),o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("产地")])),_:1}),o(R,{class:"val"},{default:s((()=>[r(p(k.product.shipping_origin||"—"),1)])),_:1})])),_:1}),o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("规格")])),_:1}),o(R,{class:"val"},{default:s((()=>[r("默认规格")])),_:1})])),_:1}),o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("单位")])),_:1}),o(R,{class:"val"},{default:s((()=>[r("件")])),_:1})])),_:1}),o(b,{class:"pd-param-item"},{default:s((()=>[o(R,{class:"key"},{default:s((()=>[r("单位价格")])),_:1}),o(R,{class:"val"},{default:s((()=>[r("¥"+p(k.product.price.toFixed(2)),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(b,{class:"pd-card pd-detail"},{default:s((()=>[o(R,{class:"pd-section-title"},{default:s((()=>[r("图文详情")])),_:1}),(i(!0),c(n,null,d(C.images,((e,s)=>(i(),t(I,{key:"d"+s,class:"pd-detail-img",src:e,mode:"widthFix"},null,8,["src"])))),128))])),_:1})])),_:1}),o(b,{class:"pd-right"},{default:s((()=>[o(b,{class:"pd-info"},{default:s((()=>[o(R,{class:"pd-title"},{default:s((()=>[r(p(k.product.title),1)])),_:1}),o(b,{class:"pd-price-row"},{default:s((()=>[o(R,{class:"pd-price"},{default:s((()=>[r("¥"+p(k.product.price.toFixed(2)),1)])),_:1}),o(R,{class:"pd-coupon"},{default:s((()=>[r("券后更低")])),_:1})])),_:1}),o(b,{class:"pd-meta"},{default:s((()=>[o(R,null,{default:s((()=>[r("包邮 ｜ 48小时内发货 ｜ 七天无理由")])),_:1})])),_:1}),o(b,null,{default:s((()=>[o(R,{class:"pd-section-title"},{default:s((()=>[r("规格明细")])),_:1}),k.specsLoading?(i(),t(b,{key:0},{default:s((()=>[o(R,{class:"pd-meta"},{default:s((()=>[r("加载中...")])),_:1})])),_:1})):k.specs&&k.specs.length?(i(),t(b,{key:1,class:"specs-list"},{default:s((()=>[(i(!0),c(n,null,d(k.specs,((e,a)=>(i(),t(b,{class:g(["spec-item",{active:k.selectedSpecIndex===a}]),key:"h5sp"+a,onClick:e=>C.selectSpec(a)},{default:s((()=>[o(I,{class:"spec-thumb",src:e.image_url||"/static/logo.png",mode:"aspectFill"},null,8,["src"]),o(b,{class:"spec-info"},{default:s((()=>[o(R,{class:"spec-name"},{default:s((()=>[r(p(e.name),1)])),_:2},1024),o(b,{class:"spec-price-row"},{default:s((()=>[o(R,{class:"spec-price"},{default:s((()=>[r("¥"+p(Number(e.price).toFixed(2)),1)])),_:2},1024),Number(e.original_price)>0?(i(),t(R,{key:0,class:"spec-oprice"},{default:s((()=>[r("¥"+p(Number(e.original_price).toFixed(2)),1)])),_:2},1024)):l("",!0)])),_:2},1024),o(R,{class:"spec-unit"},{default:s((()=>[r("单位："+p(e.unit||"—"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})):(i(),t(b,{key:2},{default:s((()=>[o(R,{class:"pd-meta"},{default:s((()=>[r("暂无规格数据")])),_:1})])),_:1}))])),_:1}),o(b,{class:"pd-form"},{default:s((()=>[o(b,{class:"pd-field inline"},{default:s((()=>[o(R,{class:"label"},{default:s((()=>[r("房间名")])),_:1}),o(b,{class:"picker-display",onClick:C.openRoomSheet},{default:s((()=>[r(p(k.roomName||"请选择房间"),1)])),_:1},8,["onClick"])])),_:1}),o(b,{class:"pd-field"},{default:s((()=>[o(R,{class:"label"},{default:s((()=>[r("色温")])),_:1}),o(A,{class:"pd-input",modelValue:k.specTemp,"onUpdate:modelValue":y[0]||(y[0]=e=>k.specTemp=e),placeholder:"如 3000K / 4000K"},null,8,["modelValue"])])),_:1}),o(b,{class:"pd-field"},{default:s((()=>[o(R,{class:"label"},{default:s((()=>[r("长度")])),_:1}),o(A,{class:"pd-input",modelValue:k.specLength,"onUpdate:modelValue":y[1]||(y[1]=e=>k.specLength=e),placeholder:"如 1m / 2m"},null,8,["modelValue"])])),_:1})])),_:1}),o(b,{class:"pd-qty"},{default:s((()=>[o(R,{class:"label"},{default:s((()=>[r("数量")])),_:1}),o(b,{class:"qty-stepper"},{default:s((()=>[o(x,{class:"step",onClick:C.decQty},{default:s((()=>[r("-")])),_:1},8,["onClick"]),o(R,{class:"count"},{default:s((()=>[r(p(k.qty),1)])),_:1}),o(x,{class:"step",onClick:C.incQty},{default:s((()=>[r("+")])),_:1},8,["onClick"])])),_:1})])),_:1}),o(b,{class:"pd-actions"},{default:s((()=>[o(x,{class:"btn-buy",onClick:C.buyNow},{default:s((()=>[r("立即购买")])),_:1},8,["onClick"]),o(x,{class:"btn-cart",onClick:C.addToCartWithQty},{default:s((()=>[r("加入购物车")])),_:1},8,["onClick"])])),_:1}),k.roomSheet?(i(),t(b,{key:0,class:"h5-mask",onClick:C.closeRoomSheet},{default:s((()=>[o(b,{class:"h5-sheet",onClick:y[3]||(y[3]=m((()=>{}),["stop"]))},{default:s((()=>[o(b,{class:"h5-title"},{default:s((()=>[r("选择房间")])),_:1}),o(b,{class:"pd-field inline"},{default:s((()=>[o(R,{class:"label"},{default:s((()=>[r("新房间名")])),_:1}),o(A,{class:"pd-input",modelValue:k.roomInput,"onUpdate:modelValue":y[2]||(y[2]=e=>k.roomInput=e),placeholder:"输入新的房间名"},null,8,["modelValue"])])),_:1}),k.roomsList&&k.roomsList.length?(i(),t(b,{key:0,class:"rooms-list"},{default:s((()=>[o(R,{class:"rooms-title"},{default:s((()=>[r("已保存房间")])),_:1}),(i(!0),c(n,null,d(k.roomsList,((e,l)=>(i(),t(b,{class:"room-item",key:"r"+l,onClick:t=>k.roomInput=e},{default:s((()=>[o(R,{class:"room-name"},{default:s((()=>[r(p(e),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):l("",!0),o(b,{class:"h5-actions"},{default:s((()=>[o(x,{class:"h5-btn ghost",onClick:C.closeRoomSheet},{default:s((()=>[r("取消")])),_:1},8,["onClick"]),o(x,{class:"h5-btn primary",onClick:C.confirmRoomSelect},{default:s((()=>[r("确定")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onClick"])):l("",!0)])),_:1})])),_:1})])),_:1})])),_:1})):l("",!0)}],["__scopeId","data-v-945bb911"]]);export{b as default};
