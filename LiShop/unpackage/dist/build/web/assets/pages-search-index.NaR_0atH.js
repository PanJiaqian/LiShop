import{u as t,c as a,w as e,d as s,o as i,a as l,b as o,t as d,f as n,r as g,F as r,v as h,i as c,e as p}from"./index-D--6mQz1.js";import{P as u}from"./ProductCard.DLNICDsN.js";import{p as m}from"./index.XrWgwEH0.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=f({components:{ProductCard:u},data:()=>({keyword:"",items:[],page:1,page_size:20,total:0,loading:!1,finished:!1}),computed:{totalPages(){const t=Number(this.total||0),a=Number(this.page_size||20);return t>0?Math.ceil(t/a):1},pageNumbers(){const t=this.totalPages;return Array.from({length:t},((t,a)=>a+1))}},onLoad(t){const a=decodeURIComponent((null==t?void 0:t.q)||"");this.keyword=a,this.fetchPage(1,!1)},onReachBottom(){this.loading||this.finished||this.fetchPage(this.page+1,!0)},methods:{cleanImage(t){if("string"!=typeof t)return"/static/logo.png";return t.replace(/`/g,"").trim()||"/static/logo.png"},normalize(t=[]){return t.map(((t,a)=>({id:(null==t?void 0:t.available_product_id)||"p"+a,title:(null==t?void 0:t.name)||"商品 "+(a+1),price:Number((null==t?void 0:t.price)??0)||0,sales:0,image:this.cleanImage(null==t?void 0:t.thumbnail)})))},fetchPage(t=1,a=!1){const e=(this.keyword||"").trim();e&&(this.loading=!0,m({user_input:e,page:t,page_size:this.page_size,sort_by:"id"}).then((e=>{var s,i;const l=Array.isArray(null==(s=null==e?void 0:e.data)?void 0:s.items)?e.data.items:[],o=Number((null==(i=null==e?void 0:e.data)?void 0:i.total)??l.length),d=this.normalize(l);this.total=o,this.page=t,this.items=a?[...this.items,...d]:d,this.finished=this.page*this.page_size>=this.total})).catch((()=>{})).finally((()=>{this.loading=!1})))},goPrev(){this.page<=1||this.loading||this.fetchPage(this.page-1,!1)},goNext(){this.page>=this.totalPages||this.loading||this.fetchPage(this.page+1,!1)},goPage(t){this.loading||t===this.page||t<1||t>this.totalPages||this.fetchPage(t,!1)}}},[["render",function(u,m,f,_,P,b){const v=c,y=s,k=t("ProductCard"),z=p;return i(),a(y,{class:"page"},{default:e((()=>[l(y,{class:"header"},{default:e((()=>[l(v,{class:"title"},{default:e((()=>[o("搜索结果")])),_:1}),l(v,{class:"kw"},{default:e((()=>[o(d(P.keyword),1)])),_:1})])),_:1}),l(y,{class:"grid2"},{default:e((()=>[(i(!0),n(r,null,g(P.items,((t,s)=>(i(),a(y,{class:"grid2-item",key:s},{default:e((()=>[l(k,{product:t},null,8,["product"])])),_:2},1024)))),128))])),_:1}),P.loading||0!==P.items.length?h("",!0):(i(),a(y,{key:0,class:"empty"},{default:e((()=>[o(" 搜索结果为空,搜索其他商品试试吧~ ")])),_:1})),P.items.length>0?(i(),a(y,{key:1,class:"pager"},{default:e((()=>[P.finished?(i(),a(y,{key:0,class:"nomore"},{default:e((()=>[o("暂时没有更多了")])),_:1})):h("",!0),l(y,{class:"pg-bar"},{default:e((()=>[l(z,{size:"mini",class:"pg-btn",disabled:P.page<=1||P.loading,onClick:b.goPrev},{default:e((()=>[o("<")])),_:1},8,["disabled","onClick"]),l(v,{class:"pg-text"},{default:e((()=>[o("第 "+d(P.page)+" / "+d(b.totalPages)+" 页，共 "+d(P.total)+" 条",1)])),_:1}),l(z,{size:"mini",class:"pg-btn",disabled:P.page>=b.totalPages||P.loading,onClick:b.goNext},{default:e((()=>[o(">")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})):h("",!0),P.loading?(i(),a(y,{key:2,class:"loading"},{default:e((()=>[o("正在加载...")])),_:1})):h("",!0)])),_:1})}],["__scopeId","data-v-ae8749b6"]]);export{_ as default};
