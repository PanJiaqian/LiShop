import{u as a,c as e,w as t,d as i,o as s,a as l,b as d,t as o,v as n,f as c,r,F as h,i as g,y as u,e as p,z as m}from"./index-D--6mQz1.js";import{P as v}from"./ProductCard.DLNICDsN.js";import{g as _,q as f}from"./index.XrWgwEH0.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b=C({components:{ProductCard:v},data:()=>({parentId:"",activeChildId:"",activeName:"",subChildren:[],items:[],page:1,page_size:32,total:0,loading:!1}),computed:{totalPages(){const a=Number(this.total||0),e=Number(this.page_size||32);return a>0?Math.ceil(a/e):1}},onLoad(a){this.parentId=decodeURIComponent((null==a?void 0:a.parent_id)||""),this.activeChildId=decodeURIComponent((null==a?void 0:a.category_id)||""),this.activeName=decodeURIComponent((null==a?void 0:a.active)||"")},onShow(){(this.parentId||this.activeChildId)&&this.loadSubChildren().then((()=>{!this.activeChildId&&this.subChildren.length&&(this.activeChildId=this.subChildren[0].categories_id||"",this.activeName=this.subChildren[0].name||""),this.activeChildId&&this.fetchPage(1)}))},methods:{cleanImage(a){if("string"!=typeof a)return"/static/logo.png";return a.replace(/`/g,"").trim()||"/static/logo.png"},normalize(a=[]){return a.map(((a,e)=>({id:(null==a?void 0:a.available_product_id)||"p"+e,title:(null==a?void 0:a.name)||"商品 "+(e+1),price:Number((null==a?void 0:a.price)??0)||0,sales:0,image:this.cleanImage(null==a?void 0:a.thumbnail)})))},async loadSubChildren(){var a;try{const e=await _({page:1,page_size:50,sort_by:"id",categories_id:this.parentId||this.activeChildId}),t=Array.isArray(null==(a=null==e?void 0:e.data)?void 0:a.items)?e.data.items:[];this.subChildren=t.map(((a,e)=>({name:(null==a?void 0:a.name)||"子分类"+(e+1),categories_id:(null==a?void 0:a.categories_id)||(null==a?void 0:a.id)||""})))}catch(e){this.subChildren=[]}},async fetchPage(a=1){var e,t;if(this.activeChildId){this.loading=!0;try{const i=await f({page:a,page_size:this.page_size,sort_by:"id",category_id:this.activeChildId}),s=Array.isArray(null==(e=null==i?void 0:i.data)?void 0:e.items)?i.data.items:[],l=Number((null==(t=null==i?void 0:i.data)?void 0:t.total)??s.length);this.items=this.normalize(s),this.total=l,this.page=a}catch(i){}finally{this.loading=!1}}},selectChild(a){this.activeChildId=a.categories_id,this.activeName=a.name||"",this.fetchPage(1)},goPrev(){this.page<=1||this.loading||this.fetchPage(this.page-1)},goNext(){this.page>=this.totalPages||this.loading||this.fetchPage(this.page+1)}}},[["render",function(v,_,f,C,b,y){const I=g,P=i,k=u,N=a("ProductCard"),z=p;return s(),e(P,{class:"page"},{default:t((()=>[l(P,{class:"header"},{default:t((()=>[l(I,{class:"title"},{default:t((()=>[d("分类商品")])),_:1}),b.activeName?(s(),e(I,{key:0,class:"kw"},{default:t((()=>[d(o(b.activeName),1)])),_:1})):n("",!0)])),_:1}),l(k,{class:"sub-nav","scroll-x":""},{default:t((()=>[l(P,{class:"nav-wrap"},{default:t((()=>[(s(!0),c(h,null,r(b.subChildren,((a,i)=>(s(),e(P,{key:i,class:m(["nav-item",a.categories_id===b.activeChildId?"active":""]),onClick:e=>y.selectChild(a)},{default:t((()=>[l(I,{class:"nav-text"},{default:t((()=>[d(o(a.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),l(P,{class:"grid2"},{default:t((()=>[(s(!0),c(h,null,r(b.items,((a,i)=>(s(),e(P,{class:"grid2-item",key:i},{default:t((()=>[l(N,{product:a},null,8,["product"])])),_:2},1024)))),128))])),_:1}),b.loading||0!==b.items.length?n("",!0):(s(),e(P,{key:0,class:"empty"},{default:t((()=>[d("暂无该子分类下的商品")])),_:1})),b.items.length>0?(s(),e(P,{key:1,class:"pager"},{default:t((()=>[l(P,{class:"pg-bar"},{default:t((()=>[l(z,{size:"mini",class:"pg-btn",disabled:b.page<=1||b.loading,onClick:y.goPrev},{default:t((()=>[d("<")])),_:1},8,["disabled","onClick"]),l(I,{class:"pg-text"},{default:t((()=>[d("第 "+o(b.page)+" / "+o(y.totalPages)+" 页，共 "+o(b.total)+" 条",1)])),_:1}),l(z,{size:"mini",class:"pg-btn",disabled:b.page>=y.totalPages||b.loading,onClick:y.goNext},{default:t((()=>[d(">")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})):n("",!0),b.loading?(s(),e(P,{key:2,class:"loading"},{default:t((()=>[d("正在加载...")])),_:1})):n("",!0)])),_:1})}],["__scopeId","data-v-b614bb99"]]);export{b as default};
