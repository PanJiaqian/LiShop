{"version":3,"file":"index.js","sources":["pages/favorites/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZmF2b3JpdGVzL2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <Skeleton :loading=\"loading\" :showTitle=\"true\" />\r\n      <view class=\"back-btn\" @click=\"goBack\">←</view>\r\n    <view v-if=\"favorites.length\" class=\"grid\">\r\n      <view class=\"item\" v-for=\"(it, i) in favorites\" :key=\"i\" @click=\"openProduct(it.id)\">\r\n        <image class=\"thumb\" :src=\"it.image\" mode=\"aspectFill\" />\r\n        <view class=\"info\">\r\n          <text class=\"name\">{{ it.title }}</text>\r\n          <text class=\"price\">{{ formatPriceWithSymbol(it.price) }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view v-else-if=\"!loading\" class=\"empty\">暂无收藏</view>\r\n    <LoginPrompt :visible=\"showLoginModal\" @close=\"closeLoginModal\" @confirm=\"goLogin\" />\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport Skeleton from '@/components/Skeleton.vue'\r\nimport LoginPrompt from '@/components/LoginPrompt.vue'\r\nimport { getFavorites } from '../../api/index.js'\r\nexport default {\r\n  components: { Skeleton, LoginPrompt },\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      favorites: [],\r\n      showLoginModal: false\r\n    }\r\n  },\r\n  onLoad() {\r\n    try {\r\n      const h = () => { this.showLoginModal = true }\r\n      this._globalLoginHandler = h\r\n      uni.$on('global-login-prompt', h)\r\n    } catch (e) {}\r\n  },\r\n  onUnload() {\r\n    try {\r\n      if (this._globalLoginHandler) uni.$off('global-login-prompt', this._globalLoginHandler)\r\n      this._globalLoginHandler = null\r\n    } catch (e) {}\r\n  },\r\n  onShow() {\r\n    try {\r\n      const u = uni.getStorageSync('user') || null\r\n      const token = (u && (u.token || (u.data && u.data.token))) || ''\r\n      if (!token) { this.loading = false; return }\r\n      getFavorites({ token }).then((res) => {\r\n        const raw = Array.isArray(res?.data?.items) ? res.data.items\r\n          : (Array.isArray(res?.items) ? res.items\r\n            : (Array.isArray(res?.data?.children) ? res.data.children\r\n              : (Array.isArray(res?.data?.list) ? res.data.list\r\n                : (Array.isArray(res?.data) ? res.data : []))))\r\n        this.favorites = (raw || []).map((it, i) => {\r\n          const img = (typeof it?.main_image === 'string' ? it.main_image.replace(/`/g, '').trim() : '')\r\n            || (typeof it?.image === 'string' ? it.image.replace(/`/g, '').trim() : '')\r\n            || (typeof it?.thumbnail === 'string' ? it.thumbnail.replace(/`/g, '').trim() : '')\r\n            || '/static/logo.png'\r\n          return {\r\n            id: it?.available_product_id || it?.product_id || it?.id || ('f' + i),\r\n            title: it?.name || it?.title || ('收藏 ' + (i + 1)),\r\n            price: (it?.price === '-' || it?.price === '—') ? '-' : (Number(it?.price ?? 0) || 0),\r\n            image: img\r\n          }\r\n        })\r\n      }).catch(() => {\r\n        this.favorites = []\r\n      }).finally(() => { this.loading = false })\r\n    } catch (e) { this.loading = false; this.favorites = [] }\r\n  },\r\n  methods: {\r\n    ensureLoggedIn() {\r\n      try {\r\n        const u = uni.getStorageSync('user') || null\r\n        const exp = uni.getStorageSync('token_expiration') || 0\r\n        const ok = !!u && (!exp || Date.now() < exp)\r\n        if (ok) return true\r\n        this.showLoginModal = true\r\n        return false\r\n      } catch (e) { return false }\r\n    },\r\n    closeLoginModal() { this.showLoginModal = false },\r\n    goLogin() { this.showLoginModal = false; uni.navigateTo({ url: '/pages/login/index' }) },\r\n    formatPriceWithSymbol(val) {\r\n      try {\r\n        if (val === '-' || val === '—') return '-'\r\n        const n = Number(val)\r\n        if (isNaN(n)) return '-'\r\n        return '¥' + n.toFixed(2)\r\n      } catch (e) { return '-' }\r\n    },\r\n    goBack() {\r\n      try {\r\n        if (typeof window !== 'undefined' && window.history && window.history.length > 1) { window.history.back(); return }\r\n      } catch (e) {}\r\n      if (uni && uni.switchTab) { uni.switchTab({ url: '/pages/home/index' }); return }\r\n      if (uni && uni.navigateTo) { uni.navigateTo({ url: '/pages/home/index' }); return }\r\n      try {\r\n        const base = (typeof location !== 'undefined' && location.href) ? location.href.split('#')[0] : ''\r\n        if (base) location.href = base + '#/pages/home/index'\r\n      } catch (e) {}\r\n    },\r\n    openProduct(id) {\r\n      if (!this.ensureLoggedIn()) return\r\n      if (!id) return\r\n      const url = '/pages/product/index?id=' + encodeURIComponent(id)\r\n      if (typeof window !== 'undefined' && window.open) {\r\n        const base = (typeof location !== 'undefined' && location.href) ? location.href.split('#')[0] : ''\r\n        const full = base ? (base + '#/pages/product/index?id=' + encodeURIComponent(id)) : url\r\n        window.open(full, '_blank')\r\n      } else if (uni && uni.navigateTo) {\r\n        uni.navigateTo({ url })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page {\r\n  min-height: 100vh;\r\n  padding: 120rpx;\r\n  box-sizing: border-box;\r\n  background: url('/static/product_detail_background.jpg') no-repeat center center;\r\n  background-size: cover;\r\n  background-attachment: fixed;\r\n}\r\n.header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 20rpx;\r\n}\r\n.title {\r\n  font-size: 34rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n.grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  grid-gap: 20rpx;\r\n}\r\n/* #ifdef H5 */\r\n.header { display: none; }\r\n.grid {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n/* #endif */\r\n\r\n.item {\r\n  background: rgba(255, 255, 255, 0.9);\r\n  border: 1rpx solid #eee;\r\n  border-radius: 12rpx;\r\n  overflow: hidden;\r\n  transition: all 0.3s;\r\n}\r\n/* #ifdef H5 */\r\n.item {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n  padding: 20rpx;\r\n}\r\n/* #endif */\r\n\r\n.thumb {\r\n  width: 100%;\r\n  height: 300rpx;\r\n  background: #f5f5f5;\r\n}\r\n/* #ifdef H5 */\r\n.thumb {\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n  flex-shrink: 0;\r\n  margin-right: 20rpx;\r\n  border-radius: 8rpx;\r\n}\r\n/* #endif */\r\n\r\n.info {\r\n  padding: 16rpx;\r\n}\r\n/* #ifdef H5 */\r\n.info {\r\n  padding: 0;\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n/* #endif */\r\n\r\n.name {\r\n  display: inline-block;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  line-height: 1.4;\r\n}\r\n.price {\r\n  display: inline-block;\r\n  font-size: 32rpx;\r\n  color: #000;\r\n  font-weight: bold;\r\n}\r\n/* #ifdef H5 */\r\n.page {\r\n  padding-left: 400rpx;\r\n  padding-right: 400rpx;\r\n}\r\n.h5-topbar {\r\n  display: none;\r\n}\r\n.back-btn {\r\n  position: fixed;\r\n  left: 40rpx;\r\n  top: 40rpx;\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  line-height: 80rpx;\r\n  text-align: center;\r\n  /* border-radius: 50%; */\r\n  /* background: rgba(255,255,255,0.7); */\r\n  /* box-shadow: 0 8rpx 24rpx rgba(0,0,0,0.12); */\r\n  color: #333;\r\n  font-size: 36rpx;\r\n  z-index: 999;\r\n  -webkit-backdrop-filter: blur(8px);\r\n  backdrop-filter: blur(8px);\r\n}\r\n.h5-topbar {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: 2;\r\n  display: flex;\r\n  align-items: center;\r\n  height: 100rpx;\r\n  padding: 20rpx;\r\n}\r\n/* #endif */\r\n.empty {\r\n  text-align: center;\r\n  color: #666;\r\n  font-size: 28rpx;\r\n  padding: 60rpx 0;\r\n  background: rgba(255,255,255,0.8);\r\n  border-radius: 12rpx;\r\n  margin-top: 40rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/HP/Desktop/LiShop/LiShop/pages/favorites/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getFavorites"],"mappings":"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"}