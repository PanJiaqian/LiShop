{"version":3,"file":"index.js","sources":["pages/search/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <Skeleton :loading=\"loading\" :showTitle=\"true\" :showGrid=\"true\" />\r\n    <view class=\"header\">\r\n      <text class=\"title\">搜索结果</text>\r\n      <text class=\"kw\">{{ keyword }}</text>\r\n    </view>\r\n\r\n  <view class=\"grid2\">\r\n    <view class=\"grid2-item\" v-for=\"(p, idx) in items\" :key=\"idx\">\r\n      <ProductCard :product=\"p\" />\r\n    </view>\r\n  </view>\r\n\r\n  <view class=\"empty\" v-if=\"!loading && items.length === 0\">\r\n      搜索结果为空,搜索其他商品试试吧~\r\n    </view>\r\n\r\n    <view class=\"loading\" v-if=\"loading\">正在加载...</view>\r\n    <view class=\"nomore\" v-if=\"finished && items.length > 0\">没有更多了</view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport ProductCard from '@/components/ProductCard.vue'\r\nimport Skeleton from '@/components/Skeleton.vue'\r\nimport { searchProducts } from '../../api/index.js'\r\n\r\nexport default {\r\n  components: { ProductCard, Skeleton },\r\n  data() {\r\n    return {\r\n      keyword: '',\r\n      category_name: '',\r\n      items: [],\r\n      page: 1,\r\n      page_size: 20,\r\n      total: 0,\r\n      loading: true,\r\n      finished: false\r\n    }\r\n  },\r\n  computed: {\r\n    totalPages() {\r\n      const t = Number(this.total || 0)\r\n      const ps = Number(this.page_size || 20)\r\n      return t > 0 ? Math.ceil(t / ps) : 1\r\n    },\r\n    pageNumbers() {\r\n      const n = this.totalPages\r\n      return Array.from({ length: n }, (_, i) => i + 1)\r\n    }\r\n  },\r\n  onLoad(query) {\r\n    const q = decodeURIComponent(query?.q || '')\r\n    const cname = decodeURIComponent(query?.category_name || '')\r\n    this.keyword = q\r\n    this.category_name = cname\r\n    this.fetchPage(1, false)\r\n  },\r\n  // 小程序端下拉到底部加载更多\r\n  onReachBottom() {\r\n    if (this.loading || this.finished) return\r\n    this.fetchPage(this.page + 1, true)\r\n  },\r\n  methods: {\r\n    cleanImage(url) {\r\n      if (typeof url !== 'string') return '/static/logo.png'\r\n      const s = url.replace(/`/g, '').trim()\r\n      return s || '/static/logo.png'\r\n    },\r\n    normalize(rows = []) {\r\n      return rows.map((it, i) => ({\r\n        id: it?.available_product_id || ('p' + i),\r\n        title: it?.name || ('商品 ' + (i + 1)),\r\n        price: (it?.price === '-' || it?.price === '—') ? '-' : (Number(it?.price ?? 0) || 0),\r\n        sales: 0,\r\n        image: this.cleanImage(it?.thumbnail)\r\n      }))\r\n    },\r\n    fetchPage(nextPage = 1, append = false) {\r\n      const q = (this.keyword || '').trim()\r\n      if (!q) return\r\n      this.loading = true\r\n      searchProducts({ user_input: q, page: nextPage, page_size: this.page_size, sort_by: 'id', category_name: this.category_name })\r\n        .then((res) => {\r\n          const items = Array.isArray(res?.data?.items) ? res.data.items : []\r\n          const total = Number(res?.data?.total ?? items.length)\r\n          const list = this.normalize(items)\r\n          this.total = total\r\n          this.page = nextPage\r\n          if (append) this.items = [...this.items, ...list]\r\n          else this.items = list\r\n          this.finished = this.page * this.page_size >= this.total\r\n        })\r\n        .catch(() => {})\r\n        .finally(() => { this.loading = false })\r\n    },\r\n    goPrev() {\r\n      if (this.page <= 1 || this.loading) return\r\n      this.fetchPage(this.page - 1, false)\r\n    },\r\n    goNext() {\r\n      if (this.page >= this.totalPages || this.loading) return\r\n      this.fetchPage(this.page + 1, false)\r\n    },\r\n    goPage(n) {\r\n      if (this.loading || n === this.page || n < 1 || n > this.totalPages) return\r\n      this.fetchPage(n, false)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page {\r\n  background: #f7f7f7;\r\n  min-height: 100vh;\r\n  width: 100vw;\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* #ifdef MP-WEIXIN */\r\n.page {\r\n  background: url('/static/product_detail_background.jpg') no-repeat center center fixed;\r\n  background-size: cover;\r\n}\r\n/* #endif */\r\n.header {\r\n  display: flex;\r\n  align-items: baseline;\r\n  padding: 20rpx;\r\n}\r\n.title { font-size: 32rpx; font-weight: 600; margin-right: 16rpx; }\r\n.kw { font-size: 28rpx; color: #666; }\r\n\r\n.grid2 {\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  grid-gap: 16rpx;\r\n  padding: 20rpx;\r\n}\r\n.grid2-item { background: #fff; border-radius: 12rpx; overflow: hidden; }\r\n\r\n.loading { text-align: center; color: #999; padding: 20rpx; }\r\n.empty { height: 40vh; display: flex; align-items: center; justify-content: center; color: #999; }\r\n.nomore { text-align: center; color: #999; padding: 12rpx; }\r\n\r\n/* #ifdef H5 */\r\n.grid2 { \r\n  grid-template-columns: repeat(8, minmax(0, 1fr)); \r\n  padding: 30rpx 100rpx;\r\n  grid-gap: 50rpx;\r\n}\r\n.header {\r\n  padding: 20rpx 80rpx;\r\n}\r\n.page {\r\n  padding-bottom: 40rpx;\r\n}\r\n@media (max-width: 1440px) {\r\n  .grid2 { grid-template-columns: repeat(6, minmax(0, 1fr)); }\r\n}\r\n@media (max-width: 1024px) {\r\n  .grid2 { grid-template-columns: repeat(4, minmax(0, 1fr)); }\r\n}\r\n@media (max-width: 640px) {\r\n  .grid2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }\r\n}\r\n/* #endif */\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/HP/Desktop/LiShop/LiShop/pages/search/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["searchProducts"],"mappings":"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"}