{"version":3,"file":"list.js","sources":["pages/category/list.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2F0ZWdvcnkvbGlzdC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <Skeleton :loading=\"loading\" :showTitle=\"true\" :showGrid=\"true\" />\r\n    <image class=\"page-bg\" src=\"/static/product_detail_background.jpg\" mode=\"aspectFill\" />\r\n    <!-- #ifdef H5 -->\r\n    <view class=\"h5-topbar\">\r\n      <button class=\"back-btn\" @click=\"goBack\">←</button>\r\n      <view class=\"h5-search\">\r\n         <image src=\"/static/logo.png?v=20251211\" style=\"width:240rpx;height:60rpx;margin-right:20rpx;\" mode=\"aspectFit\" />\r\n        <view class=\"search-bar-box\">\r\n          <view class=\"search-type\">宝贝<text class=\"arrow-down\">∨</text></view>\r\n          <view class=\"divider-v\"></view>\r\n          <input class=\"search-input-field\" v-model=\"keyword\" confirm-type=\"search\" @confirm=\"onSearch(null)\" />\r\n          <button class=\"search-btn-black\" @click=\"onSearch(null)\">搜索</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <!-- #endif -->\r\n\r\n    <scroll-view class=\"sub-nav\" scroll-x>\r\n      <view class=\"nav-wrap\">\r\n        <view v-for=\"(s, i) in subChildren\" :key=\"i\"\r\n          :class=\"['nav-item', s.categories_id === activeChildId ? 'active' : '']\" @click=\"selectChild(s)\">\r\n          <text class=\"nav-text\">{{ s.name }}</text>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <view class=\"grid2\">\r\n      <view class=\"grid2-item\" v-for=\"(p, idx) in items\" :key=\"idx\">\r\n        <ProductCard :product=\"p\" />\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"empty\" v-if=\"!loading && items.length === 0\">暂无该子分类下的商品</view>\r\n\r\n    <!-- #ifdef H5 -->\r\n    <!-- Pager removed for infinite scroll -->\r\n    <!-- #endif -->\r\n\r\n    <!-- #ifdef H5 -->\r\n    <FloatingNav :hoverReveal=\"true\" />\r\n    <!-- #endif -->\r\n\r\n    <view class=\"loading\" v-if=\"loading\">正在加载...</view>\r\n    <view class=\"nomore\" v-if=\"!loading && page >= totalPages && items.length > 0\">没有更多了</view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport ProductCard from '@/components/ProductCard.vue'\r\nimport FloatingNav from '@/components/FloatingNav.vue'\r\nimport Skeleton from '@/components/Skeleton.vue'\r\nimport { getVisibleCategories, getVisibleProducts } from '../../api/index.js'\r\n\r\nexport default {\r\n  components: { ProductCard, FloatingNav, Skeleton },\r\n  data() {\r\n    return {\r\n      keyword: '',\r\n      parentId: '',\r\n      activeChildId: '',\r\n      activeName: '',\r\n      subChildren: [],\r\n      items: [],\r\n      page: 1,\r\n      page_size: 32,\r\n      total: 0,\r\n      loading: true\r\n    }\r\n  },\r\n  computed: {\r\n    totalPages() {\r\n      const t = Number(this.total || 0)\r\n      const ps = Number(this.page_size || 32)\r\n      return t > 0 ? Math.ceil(t / ps) : 1\r\n    },\r\n    activeChildTitle() {\r\n      const s = (this.subChildren || []).find(it => it.categories_id === this.activeChildId)\r\n      return s ? (s.name || '') : ''\r\n    }\r\n  },\r\n  onLoad(query) {\r\n    this.parentId = decodeURIComponent(query?.parent_id || '')\r\n    this.activeChildId = decodeURIComponent(query?.category_id || '')\r\n    this.activeName = decodeURIComponent(query?.active || '')\r\n  },\r\n  onReachBottom() {\r\n    if (this.page >= this.totalPages || this.loading) return\r\n    this.fetchPage(this.page + 1, true)\r\n  },\r\n  onShow() {\r\n    if (!this.parentId && !this.activeChildId) return\r\n    this.loadSubChildren().then(() => {\r\n      if (!this.activeChildId && this.subChildren.length) {\r\n        this.activeChildId = this.subChildren[0].categories_id || ''\r\n        this.activeName = this.subChildren[0].name || ''\r\n      }\r\n      if (this.activeChildId) this.fetchPage(1)\r\n    })\r\n    // #ifndef H5\r\n    try { uni.setNavigationBarTitle({ title: this.activeName || '分类商品' }) } catch (e) { }\r\n    // #endif\r\n  },\r\n  methods: {\r\n    onSearch(val) {\r\n      const q = (val || this.keyword || '').trim()\r\n      if (!q) { uni.showToast({ title: '请输入关键字', icon: 'none' }); return }\r\n      uni.navigateTo({ url: '/pages/search/index?q=' + encodeURIComponent(q) + '&category_name=' + encodeURIComponent(this.activeName || '') })\r\n    },\r\n    goBack() {\r\n      if (typeof window !== 'undefined' && window.history && window.history.length > 1) { window.history.back(); return }\r\n      // #ifndef H5\n      try {\n        const pid = this.parentId || ''\n        if (pid) uni.setStorageSync('category_pending_active_id', pid)\n      } catch (e) {}\n      // #endif\n      if (uni && uni.switchTab) { uni.switchTab({ url: '/pages/category/index' }); return }\r\n      if (uni && uni.navigateTo) { uni.navigateTo({ url: '/pages/category/index' }); return }\r\n    },\r\n    cleanImage(url) {\r\n      if (typeof url !== 'string') return '/static/logo.png'\r\n      const s = url.replace(/`/g, '').trim()\r\n      return s || '/static/logo.png'\r\n    },\r\n    normalize(rows = []) {\r\n      return rows.map((it, i) => ({\r\n        id: it?.available_product_id || ('p' + i),\r\n        title: it?.name || ('商品 ' + (i + 1)),\r\n        price: (it?.price === '-' || it?.price === '—') ? '-' : (Number(it?.price ?? 0) || 0),\r\n        sales: 0,\r\n        image: this.cleanImage(it?.main_image) || this.cleanImage(it?.thumbnail)\r\n      }))\r\n    },\r\n    async loadSubChildren() {\r\n      try {\r\n        const res = await getVisibleCategories({ page: 1, page_size: 50, sort_by: 'id', categories_id: this.parentId || this.activeChildId })\r\n        const items = Array.isArray(res?.data?.items) ? res.data.items : []\r\n        this.subChildren = items.map((it, i) => ({ name: it?.name || ('子分类' + (i + 1)), categories_id: it?.categories_id || it?.id || '' }))\r\n      } catch (e) {\r\n        this.subChildren = []\r\n      }\r\n    },\r\n    async fetchPage(nextPage = 1, append = false) {\r\n      if (!this.activeChildId) return\r\n      this.loading = true\r\n      try {\r\n        const res = await getVisibleProducts({ page: nextPage, page_size: this.page_size, sort_by: 'id', category_id: this.activeChildId })\r\n        const rows = Array.isArray(res?.data?.items) ? res.data.items : []\r\n        const total = Number(res?.data?.total ?? rows.length)\r\n        const newItems = this.normalize(rows)\r\n        if (append) {\r\n          this.items = [...this.items, ...newItems]\r\n        } else {\r\n          this.items = newItems\r\n        }\r\n        this.total = total\r\n        this.page = nextPage\r\n      } catch (e) { }\r\n      finally { this.loading = false }\r\n    },\r\n    selectChild(s) {\r\n      this.activeChildId = s.categories_id\r\n      this.activeName = s.name || ''\r\n      this.fetchPage(1)\r\n    },\r\n    goPrev() {\r\n      if (this.page <= 1 || this.loading) return\r\n      this.fetchPage(this.page - 1)\r\n    },\r\n    goNext() {\r\n      if (this.page >= this.totalPages || this.loading) return\r\n      this.fetchPage(this.page + 1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page {\r\n  min-height: 100vh;\r\n  width: 100vw;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.page-bg {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  z-index: -1;\r\n}\r\n\r\n.h5-topbar {\r\n  display: none;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  align-items: baseline;\r\n  padding: 20rpx 50rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  margin-right: 16rpx;\r\n}\r\n\r\n.kw {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.sub-nav {\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.nav-wrap {\r\n  display: flex;\r\n  gap: 80rpx;\r\n  padding: 16rpx 60rpx;\r\n  white-space: nowrap;\r\n}\r\n\r\n.nav-item {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  padding: 0;\r\n  background: transparent;\r\n  border-radius: 0;\r\n}\r\n\r\n.nav-text {\r\n  font-size: 26rpx;\r\n  color: #333;\r\n}\r\n\r\n.nav-item.active .nav-text {\r\n  color: #333;\r\n  font-weight: 600;\r\n}\r\n\r\n.grid2 {\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  grid-gap: 16rpx;\r\n  padding: 20rpx;\r\n}\r\n\r\n.grid2-item {\r\n  background: #fff;\r\n  border-radius: 12rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.loading {\r\n  text-align: center;\r\n  color: #999;\r\n  padding: 20rpx;\r\n}\r\n\r\n.empty {\r\n  height: 40vh;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #999;\r\n}\r\n\r\n.nomore {\r\n  text-align: center;\r\n  color: #999;\r\n  padding: 30rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n/* #ifdef H5 */\r\n.h5-topbar {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 2;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 20rpx;\r\n  height: 120rpx;\r\n  padding: 20rpx;\r\n}\r\n\r\n.back-btn {\r\n  height: 60rpx;\r\n  width: 60rpx;\r\n  line-height: 60rpx;\r\n  padding: 0;\r\n  border: none !important;\r\n  border-radius: 0;\r\n  background: transparent !important;\r\n  box-shadow: none !important;\r\n  outline: none;\r\n  color: #000;\r\n  font-size: 44rpx;\r\n  transition: background .2s, transform .2s, color .2s;\r\n  margin-left: 20rpx;\r\n}\r\n\r\n.back-btn::after {\r\n  border: none !important;\r\n}\r\n\r\n.back-btn:hover {\r\n  transform: translateY(0.3rpx);\r\n  font-weight: 500;\r\n}\r\n\r\n.h5-search {\r\n  flex: 1;\r\n  display: flex;\r\n  /* justify-content: center; */\r\n  align-items: center;\r\n  margin-left: 200rpx;\r\n  gap: 80rpx;\r\n}\r\n\r\n.search-bar-box {\r\n  display: flex;\r\n  align-items: center;\r\n  width: 70%;\r\n  /* max-width: 900rpx; */\r\n  /* margin: 0 auto; */\r\n  height: 80rpx;\r\n  border: 3rpx solid #000;\r\n  border-radius: 40rpx;\r\n  padding: 4rpx;\r\n  background: transparent !important;\r\n}\r\n\r\n.search-type {\r\n  padding: 0 30rpx;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  font-weight: 500;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.arrow-down {\r\n  font-size: 20rpx;\r\n  margin-left: 10rpx;\r\n  color: #666;\r\n}\r\n\r\n.divider-v {\r\n  width: 2rpx;\r\n  height: 30rpx;\r\n  background: #ddd;\r\n  margin-right: 16rpx;\r\n}\r\n\r\n.search-input-field {\r\n  flex: 1;\r\n  height: 100%;\r\n  font-size: 30rpx;\r\n  background: transparent !important;\r\n  color: #000;\r\n}\r\n\r\n.search-btn-black {\r\n  background: #000;\r\n  color: #fff;\r\n  border-radius: 36rpx;\r\n  font-size: 30rpx;\r\n  font-weight: 700;\r\n  height: 70rpx;\r\n  line-height: 70rpx;\r\n  padding: 0 50rpx;\r\n  margin-right: 4rpx;\r\n}\r\n\r\n.sub-nav {\r\n  margin-top: 120rpx;\r\n}\r\n\r\n.grid2 {\r\n  grid-template-columns: repeat(8, minmax(0, 1fr));\r\n  padding: 20rpx 80rpx;\r\n  /* Add side spacing */\r\n  grid-gap: 50rpx;\r\n  /* Increase gap */\r\n}\r\n\r\n.header {\r\n  padding: 20rpx 80rpx;\r\n  /* Add side spacing */\r\n}\r\n\r\n.nav-wrap {\r\n  padding: 16rpx 80rpx;\r\n  /* Add side spacing */\r\n}\r\n\r\n.title {\r\n  font-size: 38rpx !important;\r\n}\r\n\r\n.kw {\r\n  font-size: 32rpx !important;\r\n}\r\n\r\n.nav-text {\r\n  font-size: 32rpx !important;\r\n}\r\n\r\n.page {\r\n  padding-bottom: 40rpx;\r\n}\r\n\r\n.page {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-image: url('/static/product_detail_background.jpg');\r\n  background-size: cover;\r\n  background-position: center;\r\n  z-index: 0;\r\n  overflow-y: auto;\r\n  padding: 40rpx;\r\n}\r\n\r\n@media (max-width: 1440px) {\r\n  .grid2 {\r\n    grid-template-columns: repeat(6, minmax(0, 1fr));\r\n  }\r\n}\r\n\r\n@media (max-width: 1024px) {\r\n  .grid2 {\r\n    grid-template-columns: repeat(4, minmax(0, 1fr));\r\n  }\r\n}\r\n\r\n@media (max-width: 640px) {\r\n  .grid2 {\r\n    grid-template-columns: repeat(2, minmax(0, 1fr));\r\n  }\r\n}\r\n\r\n/* #endif */\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/HP/Desktop/LiShop/LiShop/pages/category/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getVisibleCategories","getVisibleProducts"],"mappings":"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"}