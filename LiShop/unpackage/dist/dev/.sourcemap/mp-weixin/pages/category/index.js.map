{"version":3,"file":"index.js","sources":["pages/category/index.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2F0ZWdvcnkvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <Skeleton :loading=\"loading\" :showTitle=\"true\" :showGrid=\"true\" />\r\n    <!-- #ifdef MP-WEIXIN -->\r\n    <image class=\"page-bg\" src=\"/static/product_detail_background.jpg\" mode=\"aspectFill\" />\r\n    <!-- #endif -->\r\n    <view class=\"container\">\r\n      <scroll-view class=\"left\" scroll-y>\r\n        <view v-for=\"(c, idx) in categories\" :key=\"idx\" :class=\"['left-item', activeIndex === idx ? 'active' : '']\"\r\n          @click=\"selectCategory(idx)\">\r\n          <text>{{ c.name }}</text>\r\n        </view>\r\n      </scroll-view>\r\n      <scroll-view class=\"right\" scroll-y>\r\n        <view class=\"right-wrap\">\r\n          <view class=\"sub-title\">{{ activeCategory.name }}</view>\r\n          <view class=\"sub-grid\">\r\n            <view class=\"sub-item\" v-for=\"(s, i) in rightChildren\" :key=\"i\" @click=\"openList(s)\">\r\n              <image class=\"sub-icon\" :src=\"s.icon || '/static/logo.png'\" mode=\"aspectFill\" />\r\n              <text class=\"sub-name\">{{ s.name }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </scroll-view>\r\n    </view>\r\n    <!-- #ifdef H5 -->\r\n    <FloatingNav />\r\n    <!-- #endif -->\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport FloatingNav from '@/components/FloatingNav.vue'\r\nimport Skeleton from '@/components/Skeleton.vue'\r\nimport { getVisibleCategories } from '../../api/index.js'\r\nexport default {\r\n  components: { FloatingNav, Skeleton },\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      activeIndex: 0,\r\n      categories: [],\r\n      pendingActiveName: '',\r\n      pendingActiveId: '',\r\n      lastActiveId: '',\n      rightChildren: []\r\n    }\r\n  },\r\n  computed: {\r\n    activeCategory() { return this.categories[this.activeIndex] || { name: '', children: [] } }\r\n  },\r\n  onShow() {\r\n    // #ifdef H5\r\n    try { uni.hideTabBar({ animation: false }) } catch (e) { }\r\n    // #endif\r\n    let rememberedId = ''\n    // #ifndef H5\n    try {\n      const pid = uni.getStorageSync('category_pending_active_id') || ''\n      if (pid) {\n        this.pendingActiveId = pid\n        try { uni.removeStorageSync('category_pending_active_id') } catch (e) {}\n      }\n    } catch (e) {}\n    rememberedId = this.pendingActiveId || this.lastActiveId || (this.categories[this.activeIndex]?.categories_id || '')\n    // #endif\n    // 拉取分类列表用于左侧分类栏\r\n    try {\r\n      getVisibleCategories({ page: 1, page_size: 50, sort_by: 'id' })\r\n        .then((res) => {\r\n          const items = Array.isArray(res?.data?.items) ? res.data.items : []\r\n          const mapped = items.map((it, i) => ({ name: it?.name || ('分类' + (i + 1)), categories_id: it?.categories_id || it?.id || '', children: [] }))\r\n          this.categories = mapped\r\n          let selectedId = ''\n          if (this.pendingActiveId) {\n            const idxById = this.categories.findIndex(c => c.categories_id === this.pendingActiveId)\n            if (idxById >= 0) {\n              this.activeIndex = idxById\n              selectedId = this.pendingActiveId\n            }\n            this.pendingActiveId = ''\n            this.pendingActiveName = ''\n          } else if (this.pendingActiveName) {\n            const idx = this.categories.findIndex(c => c.name === this.pendingActiveName)\n            if (idx >= 0) {\n              this.activeIndex = idx\n              selectedId = this.categories[idx].categories_id || ''\n            }\n            this.pendingActiveName = ''\n          } else {\n            // #ifndef H5\n            if (rememberedId) {\n              const idxById = this.categories.findIndex(c => c.categories_id === rememberedId)\n              if (idxById >= 0) {\n                this.activeIndex = idxById\n                selectedId = rememberedId\n              }\n            }\n            // #endif\n            if (!selectedId && this.categories.length) {\n              this.activeIndex = 0\n              selectedId = this.categories[0].categories_id || ''\n            }\n          }\n          if (selectedId) this.loadChildrenById(selectedId)\n          // #ifndef H5\n          if (selectedId) this.lastActiveId = selectedId\n          // #endif\n          this.loading = false\r\n        })\r\n        .catch(() => { this.loading = false })\r\n    } catch (e) { this.loading = false }\r\n  },\r\n  onLoad(query) {\r\n    const q = decodeURIComponent(query?.active || '')\r\n    const aid = decodeURIComponent(query?.active_id || '')\r\n    this.pendingActiveName = q\r\n    this.pendingActiveId = aid\r\n  },\r\n  methods: {\r\n    selectCategory(idx) {\r\n      this.activeIndex = idx\r\n      const id = this.categories[idx]?.categories_id || ''\r\n      // #ifndef H5\n      this.lastActiveId = id || ''\n      // #endif\n      if (id) this.loadChildrenById(id)\r\n    },\r\n    loadChildrenById(id) {\r\n      try {\r\n        getVisibleCategories({ page: 1, page_size: 50, sort_by: 'id', categories_id: id })\r\n          .then((res) => {\r\n            const items = Array.isArray(res?.data?.items) ? res.data.items : []\r\n            const children = items.map((it, i) => ({\r\n              name: it?.name || ('子分类' + (i + 1)),\r\n              icon: (typeof it?.image_url === 'string' ? it.image_url.replace(/`/g, '').trim() : '')\r\n                || (typeof it?.thumbnail === 'string' ? it.thumbnail.replace(/`/g, '').trim() : '')\r\n                || (typeof it?.icon === 'string' ? it.icon.replace(/`/g, '').trim() : ''),\r\n              categories_id: it?.categories_id || it?.id || ''\r\n            }))\r\n            const idx = this.activeIndex\r\n            const cat = this.categories[idx]\r\n            if (cat) this.$set(this.categories, idx, { ...cat, children })\r\n            this.rightChildren = children\r\n          })\r\n          .catch(() => {})\r\n      } catch (e) {}\r\n    },\r\n    openList(sub) {\r\n      const parentId = this.categories[this.activeIndex]?.categories_id || ''\r\n      const cid = sub?.categories_id || ''\r\n      const pname = this.activeCategory?.name || ''\r\n      if (!cid) { uni.showToast({ title: '子分类缺少ID', icon: 'none' }); return }\r\n      const url = `/pages/category/list?parent_id=${encodeURIComponent(parentId)}&category_id=${encodeURIComponent(cid)}&active=${encodeURIComponent(pname)}`\r\n      uni.navigateTo({ url })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.page {\r\n  background: #f7f7f7;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* #ifdef MP-WEIXIN */\r\n.page { position: relative; z-index: 1; }\r\n.page-bg {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  z-index: 0;\r\n}\r\n/* #endif */\r\n\r\n.container {\r\n  display: flex;\r\n  height: calc(100vh - 88rpx);\r\n}\r\n\r\n.left {\r\n  width: 220rpx;\r\n  background: #f5f5f5;\r\n}\r\n\r\n.left-item {\r\n  padding: 24rpx;\r\n  border-left: 6rpx solid transparent;\r\n}\r\n\r\n.left-item.active {\r\n  background: #ddd;\r\n  /* border-left-color: #333; */\r\n  border-radius: 10px;\r\n  font-weight: 600;\r\n}\r\n\r\n.right {\r\n  flex: 1;\r\n  background: #fff;\r\n}\r\n\r\n.right-wrap {\r\n  padding: 20rpx 40rpx;\r\n}\r\n\r\n.sub-title {\r\n  font-size: 33rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.sub-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  grid-gap: 16rpx;\r\n}\r\n\r\n.sub-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.sub-icon {\r\n  width: 140rpx;\r\n  height: 140rpx;\r\n  border-radius: 12rpx;\r\n  background: #f5f5f5;\r\n}\r\n\r\n.sub-name {\r\n  margin-top: 12rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n/* #ifdef MP-WEIXIN */\r\n.left-item, .sub-title, .sub-name {\r\n  font-size: 28rpx !important;\r\n}\r\n/* #endif */\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/HP/Desktop/LiShop/LiShop/pages/category/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getVisibleCategories","_a"],"mappings":"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"}