{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\texport default {\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.log('App Launch')\r\n\t\t\ttry {\r\n\t\t\t\tconst allowed = new Set(['/pages/search/index', '/pages/category/list'])\r\n\t\t\t\tallowed.add('/pages/category/index')\r\n\t\t\t\tallowed.add('/pages/home/index')\r\n\t\t\t\tallowed.add('/pages/login/index')\r\n\t\t\t\tconst isLoggedIn = () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst u = uni.getStorageSync('user') || null\r\n\t\t\t\t\t\tconst exp = uni.getStorageSync('token_expiration') || 0\r\n\t\t\t\t\t\treturn !!u && (!exp || Date.now() < exp)\r\n\t\t\t\t\t} catch (e) { return false }\r\n\t\t\t\t}\r\n\t\t\t\tconst guard = (args) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (isLoggedIn()) return true\r\n\t\t\t\t\t\tconst raw = (args && args.url) || ''\r\n\t\t\t\t\t\tconst path = raw.split('?')[0]\r\n\t\t\t\t\t\tif (allowed.has(path)) return true\r\n\t\t\t\t\t\ttry { uni.$emit('global-login-prompt', { from: path, ts: Date.now() }) } catch (e) {}\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t} catch (e) { return false }\r\n\t\t\t\t}\r\n\t\t\t\tif (uni && typeof uni.addInterceptor === 'function') {\r\n\t\t\t\t\tuni.addInterceptor('navigateTo', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('switchTab', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('reLaunch', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('redirectTo', { invoke: guard })\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show')\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/*每个页面公共css */\r\n</style>\r\n","import App from './App'\r\n\r\n// #ifdef MP-WEIXIN\nconst toQueryString = (obj = {}) => {\n  return Object.keys(obj)\n    .filter((key) => obj[key] !== undefined && obj[key] !== null && obj[key] !== '')\n    .map((key) => `${encodeURIComponent(key)}=${encodeURIComponent(String(obj[key]))}`)\n    .join('&')\n}\n\nconst getShareLocation = () => {\n  const pages = typeof getCurrentPages === 'function' ? getCurrentPages() : []\n  const page = pages.length ? pages[pages.length - 1] : null\n  const route = page?.route || 'pages/home/index'\n  const query = toQueryString(page?.options || {})\n  const path = `/${route}${query ? `?${query}` : ''}`\n  return { path, query }\n}\n\nconst shareMixin = {\n  onShow() {\n    if (typeof uni !== 'undefined' && typeof uni.showShareMenu === 'function') {\n      uni.showShareMenu({\n        withShareTicket: true,\n        menus: ['shareAppMessage', 'shareTimeline']\n      })\n    }\n  },\n  onShareAppMessage() {\n    const { path } = getShareLocation()\n    return { title: '诺米', path, imageUrl: '/static/logo.png' }\n  },\n  onShareTimeline() {\n    const { query } = getShareLocation()\n    return { title: '诺米', query, imageUrl: '/static/logo.png' }\n  }\n}\n// #endif\n\n// #ifndef VUE3\r\nimport Vue from 'vue'\r\nimport './uni.promisify.adaptor'\r\nVue.config.productionTip = false\r\nApp.mpType = 'app'\r\n// #ifdef MP-WEIXIN\nVue.mixin(shareMixin)\n// #endif\nconst app = new Vue({\r\n  ...App\r\n})\r\napp.$mount()\r\n// #endif\r\n\r\n// #ifdef VUE3\r\nimport { createSSRApp } from 'vue'\r\nexport function createApp() {\r\n  const app = createSSRApp(App)\r\n  // #ifdef MP-WEIXIN\n  app.mixin(shareMixin)\n  // #endif\n  return {\r\n    app\r\n  }\r\n}\r\n// #endif\n"],"names":["uni","createSSRApp","App"],"mappings":";;;;;;;;;;;;;;;;;;;;;AACC,MAAK,YAAU;AAAA,EACd,UAAU,WAAW;AACpBA,kBAAAA,MAAA,MAAA,OAAA,gBAAY,YAAY;AACxB,QAAI;AACH,YAAM,UAAU,oBAAI,IAAI,CAAC,uBAAuB,sBAAsB,CAAC;AACvE,cAAQ,IAAI,uBAAuB;AACnC,cAAQ,IAAI,mBAAmB;AAC/B,cAAQ,IAAI,oBAAoB;AAChC,YAAM,aAAa,MAAM;AACxB,YAAI;AACH,gBAAM,IAAIA,cAAG,MAAC,eAAe,MAAM,KAAK;AACxC,gBAAM,MAAMA,cAAG,MAAC,eAAe,kBAAkB,KAAK;AACtD,iBAAO,CAAC,CAAC,MAAM,CAAC,OAAO,KAAK,IAAI,IAAI;AAAA,QACrC,SAAS,GAAG;AAAE,iBAAO;AAAA,QAAM;AAAA,MAC5B;AACA,YAAM,QAAQ,CAAC,SAAS;AACvB,YAAI;AACH,cAAI,WAAY;AAAE,mBAAO;AACzB,gBAAM,MAAO,QAAQ,KAAK,OAAQ;AAClC,gBAAM,OAAO,IAAI,MAAM,GAAG,EAAE,CAAC;AAC7B,cAAI,QAAQ,IAAI,IAAI;AAAG,mBAAO;AAC9B,cAAI;AAAEA,0BAAAA,MAAI,MAAM,uBAAuB,EAAE,MAAM,MAAM,IAAI,KAAK,IAAI,EAAA,CAAG;AAAA,UAAE,SAAS,GAAG;AAAA,UAAC;AACpF,iBAAO;AAAA,QACR,SAAS,GAAG;AAAE,iBAAO;AAAA,QAAM;AAAA,MAC5B;AACA,UAAIA,uBAAO,OAAOA,oBAAI,mBAAmB,YAAY;AACpDA,sBAAAA,MAAI,eAAe,cAAc,EAAE,QAAQ,OAAO;AAClDA,sBAAAA,MAAI,eAAe,aAAa,EAAE,QAAQ,OAAO;AACjDA,sBAAAA,MAAI,eAAe,YAAY,EAAE,QAAQ,OAAO;AAChDA,sBAAAA,MAAI,eAAe,cAAc,EAAE,QAAQ,OAAO;AAAA,MACnD;AAAA,aACQ,GAAG;AAAA,IAAC;AAAA,EACb;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACvB;AACD;ACrCD,MAAM,gBAAgB,CAAC,MAAM,OAAO;AAClC,SAAO,OAAO,KAAK,GAAG,EACnB,OAAO,CAAC,QAAQ,IAAI,GAAG,MAAM,UAAa,IAAI,GAAG,MAAM,QAAQ,IAAI,GAAG,MAAM,EAAE,EAC9E,IAAI,CAAC,QAAQ,GAAG,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,EAAE,EACjF,KAAK,GAAG;AACb;AAEA,MAAM,mBAAmB,MAAM;AAC7B,QAAM,QAAQ,OAAO,oBAAoB,aAAa,gBAAiB,IAAG,CAAE;AAC5E,QAAM,OAAO,MAAM,SAAS,MAAM,MAAM,SAAS,CAAC,IAAI;AACtD,QAAM,SAAQ,6BAAM,UAAS;AAC7B,QAAM,QAAQ,eAAc,6BAAM,YAAW,CAAA,CAAE;AAC/C,QAAM,OAAO,IAAI,KAAK,GAAG,QAAQ,IAAI,KAAK,KAAK,EAAE;AACjD,SAAO,EAAE,MAAM,MAAO;AACxB;AAEA,MAAM,aAAa;AAAA,EACjB,SAAS;AACP,QAAI,OAAOA,cAAG,UAAK,eAAe,OAAOA,cAAAA,MAAI,kBAAkB,YAAY;AACzEA,oBAAAA,MAAI,cAAc;AAAA,QAChB,iBAAiB;AAAA,QACjB,OAAO,CAAC,mBAAmB,eAAe;AAAA,MAClD,CAAO;AAAA,IACF;AAAA,EACF;AAAA,EACD,oBAAoB;AAClB,UAAM,EAAE,KAAM,IAAG,iBAAkB;AACnC,WAAO,EAAE,OAAO,MAAM,MAAM,UAAU,mBAAoB;AAAA,EAC3D;AAAA,EACD,kBAAkB;AAChB,UAAM,EAAE,MAAO,IAAG,iBAAkB;AACpC,WAAO,EAAE,OAAO,MAAM,OAAO,UAAU,mBAAoB;AAAA,EAC5D;AACH;AAmBO,SAAS,YAAY;AAC1B,QAAM,MAAMC,cAAY,aAACC,SAAG;AAE5B,MAAI,MAAM,UAAU;AAEpB,SAAO;AAAA,IACL;AAAA,EACD;AACH;;;"}