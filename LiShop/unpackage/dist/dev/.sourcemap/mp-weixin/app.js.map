{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\texport default {\r\n\t\tonLaunch: function(args) {\r\n\t\t\tconsole.log('App Launch')\r\n\t\t\ttry {\r\n\t\t\t\tconst scene = Number(args && args.scene) || 0\r\n\t\t\t\tconst fromShare = scene === 1007 || scene === 1008 || scene === 1044 || scene === 1096 || scene === 1154 || scene === 1155\r\n\t\t\t\tif (fromShare) {\r\n\t\t\t\t\ttry { uni.reLaunch({ url: '/pages/home/index' }) } catch (e) {}\r\n\t\t\t\t}\r\n\t\t\t\tconst allowed = new Set(['/pages/search/index', '/pages/category/list'])\r\n\t\t\t\tallowed.add('/pages/category/index')\r\n\t\t\t\tallowed.add('/pages/home/index')\r\n\t\t\t\tallowed.add('/pages/login/index')\r\n\t\t\t\tconst isLoggedIn = () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst u = uni.getStorageSync('user') || null\r\n\t\t\t\t\t\tconst exp = uni.getStorageSync('token_expiration') || 0\r\n\t\t\t\t\t\treturn !!u && (!exp || Date.now() < exp)\r\n\t\t\t\t\t} catch (e) { return false }\r\n\t\t\t\t}\r\n\t\t\t\tconst guard = (args) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (isLoggedIn()) return true\r\n\t\t\t\t\t\tconst raw = (args && args.url) || ''\r\n\t\t\t\t\t\tconst path = raw.split('?')[0]\r\n\t\t\t\t\t\tif (allowed.has(path)) return true\r\n\t\t\t\t\t\ttry { uni.$emit('global-login-prompt', { from: path, ts: Date.now() }) } catch (e) {}\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t} catch (e) { return false }\r\n\t\t\t\t}\r\n\t\t\t\tif (uni && typeof uni.addInterceptor === 'function') {\r\n\t\t\t\t\tuni.addInterceptor('navigateTo', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('switchTab', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('reLaunch', { invoke: guard })\r\n\t\t\t\t\tuni.addInterceptor('redirectTo', { invoke: guard })\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t},\r\n\t\tonShow: function(args) {\r\n\t\t\tconsole.log('App Show')\r\n\t\t\ttry {\r\n\t\t\t\tconst scene = Number(args && args.scene) || 0\r\n\t\t\t\tconst fromShare = scene === 1007 || scene === 1008 || scene === 1044 || scene === 1096 || scene === 1154 || scene === 1155\r\n\t\t\t\tif (fromShare) {\r\n\t\t\t\t\ttry { uni.reLaunch({ url: '/pages/home/index' }) } catch (e) {}\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t/*每个页面公共css */\r\n</style>\r\n","import App from './App'\r\n\r\n// #ifdef MP-WEIXIN\r\nconst SHARE_TITLE = '诺米灯光定制'\r\nconst SHARE_PATH = '/pages/home/index'\r\nconst SHARE_QUERY = ''\r\nconst FALLBACK_SHARE_IMAGE_URL = '/static/logo.png'\r\nconst SHARE_IMAGE_STORAGE_KEY = 'share_image_url'\r\n\r\nconst cleanUrl = (u) => (typeof u === 'string' ? u.replace(/`/g, '').trim() : '')\r\n\r\nconst getShareImageUrl = () => {\r\n  try {\r\n    const cached = uni.getStorageSync(SHARE_IMAGE_STORAGE_KEY)\r\n    if (cached) return cached\r\n  } catch (e) {}\r\n  return FALLBACK_SHARE_IMAGE_URL\r\n}\r\n\r\ntry {\r\n  if (typeof uni !== 'undefined' && typeof uni.request === 'function') {\r\n    uni.request({\r\n      url: 'https://www.nuomi-light.com:6149/api/carousel',\r\n      method: 'GET',\r\n      success: (res) => {\r\n        try {\r\n          let existing = ''\r\n          try { existing = uni.getStorageSync(SHARE_IMAGE_STORAGE_KEY) || '' } catch (e) { existing = '' }\r\n          const hasLocalPoster = typeof existing === 'string' && (existing.startsWith('wxfile://') || existing.startsWith('file://'))\r\n          if (hasLocalPoster) return\r\n          let data = res?.data\r\n          if (typeof data === 'string') { try { data = JSON.parse(data) } catch (e) {} }\r\n          const items = Array.isArray(data?.data?.items) ? data.data.items : (Array.isArray(data?.items) ? data.items : [])\r\n          const first = items && items.length ? items[0] : null\r\n          const img = cleanUrl(first?.image || first?.thumbnail || first?.url || '')\r\n          if (img) {\r\n            try { uni.setStorageSync(SHARE_IMAGE_STORAGE_KEY, img) } catch (e) {}\r\n          }\r\n        } catch (e) {}\r\n      }\r\n    })\r\n  }\r\n} catch (e) {}\r\n\r\nconst shareMixin = {\r\n  onShow() {\r\n    if (typeof uni !== 'undefined' && typeof uni.showShareMenu === 'function') {\r\n      uni.showShareMenu({\r\n        withShareTicket: true,\r\n        menus: ['shareAppMessage', 'shareTimeline']\r\n      })\r\n    }\r\n  },\r\n  onShareAppMessage() {\r\n    return { title: SHARE_TITLE, path: SHARE_PATH, imageUrl: getShareImageUrl() }\r\n  },\r\n  onShareTimeline() {\r\n    return { title: SHARE_TITLE, query: SHARE_QUERY, imageUrl: getShareImageUrl() }\r\n  }\r\n}\r\n// #endif\r\n\r\n// #ifndef VUE3\r\nimport Vue from 'vue'\r\nimport './uni.promisify.adaptor'\r\nVue.config.productionTip = false\r\nApp.mpType = 'app'\r\n// #ifdef MP-WEIXIN\r\nVue.mixin(shareMixin)\r\n// #endif\r\nconst app = new Vue({\r\n  ...App\r\n})\r\napp.$mount()\r\n// #endif\r\n\r\n// #ifdef VUE3\r\nimport { createSSRApp } from 'vue'\r\nexport function createApp() {\r\n  const app = createSSRApp(App)\r\n  // #ifdef MP-WEIXIN\r\n  app.mixin(shareMixin)\r\n  // #endif\r\n  return {\r\n    app\r\n  }\r\n}\r\n// #endif\r\n"],"names":["uni","args","createSSRApp","App"],"mappings":"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"}